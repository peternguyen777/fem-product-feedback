import React, { useState, useMemo } from "react";
import Head from "next/head";
import Header from "../components/suggestions/Header";
import MobileMenu from "../components/suggestions/MobileMenu";
import SortBar from "../components/suggestions/SortBar";
import CardSuggestions from "../components/UI/CardSuggestions";

import { sortFunction } from "../components/sort/sort";

//import json data
import data from "../public/data.json";

export default function Home() {
  const [mobMenuOpen, setMobMenuOpen] = useState(false);
  const [filterMenuOpen, setFilterMenuOpen] = useState(false);
  const [filterSelect, setFilterSelect] = useState("Most Upvotes");
  const [categorySelect, setCategorySelect] = useState("all");

  const sortedRequests = useMemo(() => {
    const input = data.productRequests;
    return sortFunction(input, filterSelect, categorySelect);
  }, [filterSelect, categorySelect]);

  return (
    <div className='relative flex h-screen flex-col'>
      <Head>
        <title>Product Feedback</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/assets/favicon-32x32.png' />
      </Head>
      <MobileMenu
        mobMenuOpen={mobMenuOpen}
        setMobMenuOpen={setMobMenuOpen}
        categorySelect={categorySelect}
        setCategorySelect={setCategorySelect}
      />

      <Header mobMenuOpen={mobMenuOpen} setMobMenuOpen={setMobMenuOpen} />
      <SortBar
        filterMenuOpen={filterMenuOpen}
        setFilterMenuOpen={setFilterMenuOpen}
        filterSelect={filterSelect}
        setFilterSelect={setFilterSelect}
      />

      <main className='bg-lightgray' onClick={() => setFilterMenuOpen(false)}>
        <ul className='mx-6 mt-8 mb-14 space-y-4'>
          {sortedRequests.map((product) => (
            <li key={product.id}>
              <CardSuggestions
                productData={product}
                setCategorySelect={setCategorySelect}
              />
            </li>
          ))}
        </ul>
      </main>
      <div
        className='w-full flex-1 bg-lightgray'
        onClick={() => setFilterMenuOpen(false)}
      ></div>
    </div>
  );
}
